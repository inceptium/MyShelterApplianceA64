var cambiaStato=function(){var g;var f=this;var c;var a=0;var b=true;var e="nulla";var d=new Date();var h=d.getTime();this.parserXml=function(j){g=j;$(j).find("elemento").each(function(){if(gruppoInCarica==false){var l=$(this).attr("id");var v=$(this).attr("type");var r=$(this).attr("status");var k=$(this).attr("currentvalue");var x=$(this).attr("title");var t=$(this).attr("label_value");var o=$(this).attr("id_group");var m=$(this).attr("currenttextvalue");var s=$(this).attr("des_group");var z=new elaboraStringhe();m=z.elaboraCurrentextvalue(m);var q=z.getNumeroRigheStatusMonitor();try{for(i=0;i<arrayElementi.length;i++){if(gruppoInCarica==true){break}if(arrayElementi[i].getIdElemento()==l){if(arrayElementi[i].getComandoInviato()==false){if(arrayElementi[i].getValoreNumerico()!=k){arrayElementi[i].setValoreNumerico(k)}if(arrayElementi[i].getRigheStatusMonitor()!=q){arrayElementi[i].setRigheStatusMonitor(q)}if(m==""){localStorage.setItem(l+"StatusMonitor","Letto")}if(arrayElementi[i].getValoreStringa()!=m&&m!=""){arrayElementi[i].setValoreStringa(m);var w=JSON.parse(localStorage.getItem("gruppo_"+o));for(y=0;y<w.length;y++){if(w[y][0]==l){w[y][7]=m}}localStorage.setItem("gruppo_"+o,JSON.stringify(w));localStorage.statusMonitorLetto="no";localStorage.setItem(l+"StatusMonitor","no")}if(arrayElementi[i].getStatoCorrente()!=r){arrayElementi[i].setStatoCorrente(r)}arrayElementi[i].rinfresca()}if(arrayElementi[i].getAggiornamentoElementoInCorso){var u=new Date();var A=u.getTime();var p=A-arrayElementi[i].tempoInvioComando;if(p>5000){arrayElementi[i].setStatoCorrente(r);arrayElementi[i].rinfresca()}}}}}catch(n){}}});window.setTimeout(function(){f.aggiorna()},700)};this.aggiorna=function(){if(aggiornamentoInCorso==1){firma1=new firma();if(firma1.token!="no_md5"){firmaM=firma1.nuovaFirma()}else{firmaM=""}$.ajax({type:"GET",url:"http://"+window.location.host.toString()+"/command=get?elements_status"+firmaM,dataType:"xml",timeout:18000,async:true,error:function(k){if(e!="nulla"){footer1.connessione(footer1.immagineCNulla);e="nulla"}if(k.status==403){if(a==1){var j=new finestra();j.apriFinestra2("Password non valida, Effettua il login.");$("#contenuto").remove();a=0}else{a=1;f.aggiorna()}}else{var l=new finestra();l.apriFinestra2('Errore, aggiornamento tra <b id="timerErrore">20</b> secondi..');f.decrementaTimer()}},success:function(l){var n=new Date();var j=n.getTime();var m=j-h;h=j;var k=m-700;if(k<400){if(e!="verde"){footer1.connessione(footer1.immagineCVerde);e="verde"}}if(k>400&&k<1000){if(e!="gialla"){footer1.connessione(footer1.immagineCGialla);e="gialla"}}if(k>1000&&k<2000){if(e!="rossa"){footer1.connessione(footer1.immagineCRossa);e="rossa"}}if(k>2000){if(e!="nulla"){footer1.connessione(footer1.immagineCNulla);e="nulla"}}$("#messaggioErrore").empty();b=!b;window.setTimeout(function(){testata1.logo(b)},100);f.parserXml(l)}})}};this.decrementaTimer=function(){var j=parseInt($("#timerErrore").text());if(j==0){f.aggiorna();$("#textaree").empty()}else{j=j-1;$("#timerErrore").empty();$("#timerErrore").append(j);window.setTimeout(function(){f.decrementaTimer()},1000)}}};